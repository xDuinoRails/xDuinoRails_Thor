kibot:
  version: 1

filters:
  - name: 'hide_refs'
    comment: 'Ersetzt den Referenz-Text durch ein Leerzeichen'
    type: field_modify
    fields: ['Reference']
    regex: '.*'
    replace: ' '

variants:
  - name: 'clean_render_variant'
    comment: 'Variante ohne sichtbare Referenzen'
    type: kibom
    pre_transform:
      - 'hide_refs'

preflight:
  erc:
    enabled: true
    warnings_as_errors: false
  drc:
    enabled: false
    warnings_as_errors: false

outputs:
  - name: 'PDF_Schaltplan'
    comment: 'Erzeugt ein PDF des Schaltplans'
    type: pdf_sch_print
    dir: '.'

  - name: 'PDF_PCB_alle_Lagen_zusammen'
    comment: "Alle PCB Lagen in einem PDF"
    type: pcb_print
    options:
      format: PDF
      output: '%f-PCB_All.pdf'
      pages:
        - layers: all
          sheet: 'S.'

  - name: 'PDF_PCB_alle_Lagen_einzeln_gross'
    comment: "Alle PCB Lagen Gross (Migriert)"
    type: pcb_print
    options:
      format: PDF
      output: '%f-PCB_All_Layers_Big.pdf'
      scaling: 0
      plot_sheet_reference: true
      pages:
        - layers: [ 'F.Cu' ]
        - layers: [ 'In1.Cu' ]
        - layers: [ 'In2.Cu' ]
        - layers: [ 'B.Cu' ]
        - layers: [ 'F.SilkS' ]
        - layers: [ 'B.SilkS' ]
        - layers: [ 'F.Mask' ]
        - layers: [ 'B.Mask' ]
        - layers: [ 'Edge.Cuts' ]
        - layers: [ 'F.Fab' ]

  - name: 'PDF_PCB_auessere_Kupfer_Lagen'
    comment: "Äussere PCB Kupfer Lagen"
    type: pcb_print
    options:
      format: PDF
      output: '%f-PCB_FB_Cu_Layers.pdf'
      plot_sheet_reference: true
      pages:
        - layers: [ 'F.Cu', 'B.Cu' ]

  - name: 'PDF_PCB_auessere_Kupfer_Lagen_gross'
    comment: "Äussere PCB Kupfer Lagen"
    type: pcb_print
    options:
      format: PDF
      output: '%f-PCB_FB_Cu_Layers_Big.pdf'
      scaling: 0
      plot_sheet_reference: true
      pages:
        - layers: [ 'F.Cu', 'B.Cu' ]

  - name: 'highlight_u_plus'
    comment: 'Hervorhebung des Netzes U+ auf Seitengröße'
    type: pcbdraw
    options:
      format: png
      # PcbDraw nutzt 'highlight' (Liste von Netzen), um diese farblich zu markieren
      highlight: ['U+']
      # Zeige keine Komponenten, um den Fokus auf die Leiterbahnen zu legen (optional anpassbar)
      show_components: none
      # Stellt sicher, dass das Board auf der Seite zentriert/sichtbar ist
      # Hinweis: PcbDraw exportiert oft in Board-Größe. Für A4-Scaling müsste man ggf. SVG nutzen und konvertieren.
      output: '%f-U_Plus.%x'

  - name: 'highlight_gnd'
    comment: 'Hervorhebung des Netzes GND auf Seitengröße'
    type: pcbdraw
    options:
      format: png
      highlight: ['GND']
      show_components: none
      output: '%f-GND.%x'

  - name: '3D_Top_View'
    comment: "Render der Oberseite (KiCad Internal)"
    # Doku bestätigt: 'render_3d' ist der korrekte Typ
    type: render_3d
    dir: 'images'
    options:
      width: 1024
      height: 768
      view: top      
      output: '%f-3D_Top.png'

  - name: '3D_Bottom_View'
    comment: "Render der Unterseite (KiCad Internal)"
    type: render_3d
    dir: 'images'
    options:
      width: 1024
      height: 768
      view: bottom
      # ray_tracing: true
      output: '%f-3D_Bottom.png'

  - name: 'Gerber_Dateien'
    comment: 'Erzeugt Gerber-Daten für die Fertigung'
    type: gerber
    dir: 'grbr'
    options:
      use_protel_extensions: true
      plot_footprint_refs: false
      plot_footprint_values: false      

  - name: 'Bohr_Dateien'
    comment: 'Erzeugt Excellon-Bohrdateien'
    type: excellon
    dir: 'grbr'


  - name: 'Stueckliste_BOM'
    comment: 'Erzeugt eine Stückliste im CSV-Format'
    type: bom
    dir: 'CAM'
    options:
      format: CSV
      columns:
        - field: 'Reference'
          name: 'Designator'
        - field: 'Value'
          name: 'Value'
        - field: 'Footprint'
          name: 'Package'
        - field: 'OLI_ID'
          name: 'Olis ID #'

  - name: 'position_files'
    comment: 'Positionsdateien für die Bestückung (Pick & Place)'
    type: position
    dir: 'CAM'
    options:
      format: 'CSV'
      units: 'millimeters'
      separate_files_for_front_and_back: true
      columns:
        - id: Ref
          name: Designator
        - id: PosX
          name: "Mid X"
        - id: PosY
          name: "Mid Y"
        - id: Side
          name: Layer
        - id: Rot
          name: Rotation

  - name: 'Spice_Netlist'
    comment: 'Export ngspice netlist'
    type: netlist
    dir: 'Spice'
    options:
      format: 'spice'

  - name: 'Fertigungsdaten_ZIP'
    comment: 'Erzeugt ein ZIP-Archiv mit allen Fertigungsdaten'
    type: compress
    dir: 'CAM'
    options:
      format: ZIP
      files:
        - from_output: 'Gerber_Dateien'
          dest: '/'
        - from_output: 'Bohr_Dateien'
          dest: '/'

  - name: 'Pinion_Image'
    comment: 'Generate a picture of the board for Pinion'
    type: pcbdraw
    dir: 'assets'
    options:
      format: png
      output: board_top.png
      style: oshpark-purple

  - name: 'Interactive_BOM'
    comment: 'Erzeugt eine interaktive HTML-Stückliste (iBOM)'
    type: ibom
    options:
      dark_mode: true
      sort_order: 'C,R,L,D,U,J,T'
      # ÄNDERUNG: Werte als kommagetrennter String, nicht als Liste
      show_fields: 'Value,Footprint'
      group_fields: 'Value,Footprint'
      output: '%f-iBOM.html'
